{% extends 'base.html' %}

{% block title %} Chat {% endblock %}

{% block content %}

<section>
    <div class="container py-5">
        <div class="row">
            <div class="col-md-6 col-lg-5 col-xl-4 mb-4 mb-md-0">
                <h5 class="font-weight-bold mb-3 text-center text-lg-start">Friends:</h5>
                <div class="card">
                    <div class="card-body">
                        <ul class="list-unstyled mb-0">
                            {% if users %}
                            {% for user in users %}
                            <li class="p-2 border-bottom" style="background-color: #eee;">
                                <a href="#" class="d-flex justify-content-between">
                                    <div class="d-flex flex-row">
                                        {% if user.profile.profile_picture %}
                                        <img src="{{ user.profile.profile_picture }}" alt="avatar"
                                             class="rounded-circle d-flex align-self-center me-3 shadow-1-strong"
                                             width="60" height="60">
                                        {% else %}
                                        <img src="/static/profile_picture/profile_picture.jpg"
                                             alt="avatar"
                                             class="rounded-circle d-flex align-self-center me-3 shadow-1-strong"
                                             width="60" height="60">
                                        {% endif %}
                                        <div class="pt-1">
                                            <a href="{% url 'chat' username=user.username %}"
                                               class="fw-bold text-dark text-decoration-none">{{ user.first_name }}
                                                {{ user.last_name }}</a>
                                        </div>
                                    </div>
                                    <div class="pb-3">
                                        <div class="badge bg-danger float-end msg">0</div>
                                    </div>
                                </a>
                            </li>
                            {% endfor %}
                            {% else %}
                            <p>It looks like you don't have any friends yet to chat with. Don't worry, you can start by
                                following other users and they can follow you back. Once you're following each other,
                                you'll be able to chat.
                                To find other users to follow, you can search for them using the search bar or browse
                                through the list of suggested users. Remember to also update your own profile so others
                                can find and follow you too.
                                Happy chatting!</p>
                            {% endif %}
                        </ul>
                    </div>
                </div>
            </div>
        </div>
    </div>
</section>

<script>
    setInterval(getNotification, 1000)

    function getNotification() {
        let url = "{% url 'notification' %}";
        fetch(url)
            .then(res => res.json())
            .then(data => {
                console.log(data)
                let chatNotificationBtn = document.getElementsByClassName("msg")
                for (let i = 0; i < data.length; i++) {
                    chatNotificationBtn[i].innerText = data[i]
                }
            })
            .catch(error => console.log(error))
    }
</script>

{% endblock %}